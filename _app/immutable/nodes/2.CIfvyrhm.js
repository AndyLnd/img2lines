import{f as $,b as j}from"../chunks/Bs9UZHtT.js";import{i as J}from"../chunks/6qnzYKYY.js";import{a0 as W,a1 as X,a2 as Q,w as k,a3 as Z,r as z,t as tt,K as nt,E as f,y as et,L as v,M as p,N as _,a4 as w,a5 as y,u as st,a6 as R}from"../chunks/DC8TlEyK.js";import{l as at,e as ot}from"../chunks/_Zn-vQ2v.js";import{b as A}from"../chunks/_qgIZdzR.js";const rt=Symbol("is custom element"),it=Symbol("is html");function b(t,n,e,a){var s=ct(t);k&&(s[n]=t.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&t.nodeName==="LINK")||s[n]!==(s[n]=e)&&(n==="loading"&&(t[W]=e),e==null?t.removeAttribute(n):typeof e!="string"&&dt(t).includes(n)?t[n]=e:t.setAttribute(n,e))}function ct(t){return t.__attributes??(t.__attributes={[rt]:t.nodeName.includes("-"),[it]:t.namespaceURI===X})}var O=new Map;function dt(t){var n=O.get(t.nodeName);if(n)return n;O.set(t.nodeName,n=[]);for(var e,a=t,s=Element.prototype;s!==a;){e=Z(a);for(var o in e)e[o].set&&n.push(o);a=Q(a)}return n}function ft(t,n,e=n){at(t,"change",()=>{e(t.files)}),k&&t.files&&e(t.files),z(()=>{t.files=n()})}const U=(t,n,e)=>{const a=t/n*Math.PI*2;return{x:Math.sin(a)*e,y:-Math.cos(a)*e}};function C(t){t.fillStyle="#fff",t.fillRect(0,0,t.canvas.width,t.canvas.height)}function L(t,n,e,a=.5){const s=t.canvas.width/2,o=t.canvas.height/2,r=Math.min(s,o)-10;t.lineJoin="round",t.lineWidth=a,t.beginPath();const{x:i,y:c}=U(e[0],n,r);t.moveTo(i+s,c+o);for(let l=1;l<e.length;l++){const{x:M,y:g}=U(e[l],n,r);t.lineTo(M+s,g+o)}t.stroke()}function q(t){const{width:n,height:e}=t.canvas,a=t.getImageData(0,0,n,e).data,s=new Uint8ClampedArray(a.length/4);for(let o=0;o<a.length;o+=4){const r=a[o],i=a[o+1],c=a[o+2];s[o/4]=r*.3+i*.6+c*.1}return s}function lt(t,n){const e=Math.min(t.length,n.length);let a=0;for(let s=0;s<e;s++)a+=(t[s]-n[s])**2;return a}function ut(t){const n=t.reduce((s,o)=>o<s?o:s,t[0]),a=255/(t.reduce((s,o)=>o>s?o:s,t[0])-n);return t.map(s=>(s-n)*a)}function gt(t,n){return[...t.reduce((a,s,o)=>(s!==n||(t[o-1]&&a.add(t[o-1]),t[o+1]&&a.add(t[o+1])),a),new Set([n]))]}const ht=(t,n,e)=>{const a=gt(n,e),s=Array(t).fill(0).map((r,i)=>i),o=s.filter(r=>!a.includes(r));return o.length>0?o:s.filter(r=>r!==e)};function mt(t,n,e,a,s){const o=e.map(i=>{C(a),L(a,t,[...n,i],.2);const c=q(a);return lt(c,s)}),r=o.reduce((i,c,l)=>c<o[i]?l:i,0);return e[r]}function F(t){const n=document.createElement("canvas");return n.width=t,n.height=t,n.getContext("2d",{willReadFrequently:!0})}function vt(t){return new Promise(n=>{const e=new Image;e.onload=()=>n(e),e.src=URL.createObjectURL(t)})}async function pt(t,n){const e=F(n),a=await vt(t),{width:s,height:o}=a,r=s-o,[i,c]=r>0?[r/2,0]:[0,-r/2],l=Math.min(s,o);return e.drawImage(a,i,c,l,l,0,0,n,n),e}var _t=$('<div class="p-8 flex flex-col gap-4"><div><input class="bg-emerald-200 border border-emerald-800 rounded p-4 inline" type="file"/></div> <div><button class="bg-emerald-200 p-2 border border-emerald-800 rounded min-w-2xs disabled:opacity-50">go</button></div> <div></div> <div class="flex items-center"><canvas></canvas> <canvas></canvas></div></div>');function Nt(t,n){tt(n,!1);let e=w(),a=w(),s=w(),o=w();const r=200,i=1e3,c=128,l=20;async function M(){const d=f(o)[0],D=await pt(d,r),P=f(e).getContext("2d");C(P),P.drawImage(D.canvas,0,0);const B=ut(q(D)),G=F(r),m=f(a).getContext("2d"),u=[0];for(;u.length<i;){const H=u.at(-1),K=ht(c,u,H),Y=mt(c,u,K,G,B);u.push(Y),u.length%l===0&&(await new Promise(requestAnimationFrame),R(s,f(s).textContent=`${u.length} / ${i}`),C(m),L(m,c,u,1))}R(s,f(s).textContent="done"),C(m),L(m,c,u,1)}J();var g=_t(),N=v(g),V=v(N);p(N);var S=_(N,2),T=v(S);p(S);var x=_(S,2);A(x,d=>y(s,d),()=>f(s));var E=_(x,2),h=v(E);b(h,"width",r),b(h,"height",r),A(h,d=>y(e,d),()=>f(e));var I=_(h,2);b(I,"width",r*3),b(I,"height",r*3),A(I,d=>y(a,d),()=>f(a)),p(E),p(g),nt(()=>T.disabled=(f(o),st(()=>{var d;return((d=f(o))==null?void 0:d.length)<1}))),ft(V,()=>f(o),d=>y(o,d)),ot("click",T,M),j(t,g),et()}export{Nt as component};

import{f as J,b as W}from"../chunks/Bs9UZHtT.js";import{i as X}from"../chunks/6qnzYKYY.js";import{a0 as Q,a1 as Z,a2 as z,w as F,a3 as tt,r as nt,t as et,K as at,E as l,y as st,L as v,M as _,N as w,a4 as y,a5 as b,u as ot,a6 as O}from"../chunks/DC8TlEyK.js";import{l as it,e as rt}from"../chunks/_Zn-vQ2v.js";import{b as A}from"../chunks/_qgIZdzR.js";const ct=Symbol("is custom element"),dt=Symbol("is html");function M(t,n,a,e){var s=ft(t);F&&(s[n]=t.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&t.nodeName==="LINK")||s[n]!==(s[n]=a)&&(n==="loading"&&(t[Q]=a),a==null?t.removeAttribute(n):typeof a!="string"&&lt(t).includes(n)?t[n]=a:t.setAttribute(n,a))}function ft(t){return t.__attributes??(t.__attributes={[ct]:t.nodeName.includes("-"),[dt]:t.namespaceURI===Z})}var U=new Map;function lt(t){var n=U.get(t.nodeName);if(n)return n;U.set(t.nodeName,n=[]);for(var a,e=t,s=Element.prototype;s!==e;){a=tt(e);for(var o in a)a[o].set&&n.push(o);e=z(e)}return n}function gt(t,n,a=n){it(t,"change",()=>{a(t.files)}),F&&t.files&&a(t.files),nt(()=>{t.files=n()})}const x=(t,n,a)=>{const e=t/n*Math.PI*2;return{x:Math.sin(e)*a,y:-Math.cos(e)*a}};function N(t){t.fillStyle="#fff",t.fillRect(0,0,t.canvas.width,t.canvas.height)}function I(t,n,a,e=.5){const s=t.canvas.width/2,o=t.canvas.height/2,i=Math.min(s,o)-10;t.lineJoin="round",t.lineWidth=e,t.beginPath();const{x:r,y:d}=x(a[0],n,i);t.moveTo(r+s,d+o);for(let c=1;c<a.length;c++){const{x:u,y:h}=x(a[c],n,i);t.lineTo(u+s,h+o)}t.stroke()}function k(t){const{width:n,height:a}=t.canvas,e=t.getImageData(0,0,n,a).data,s=new Uint8ClampedArray(e.length/4);for(let o=0;o<e.length;o+=4){const i=e[o],r=e[o+1],d=e[o+2];s[o/4]=i*.3+r*.6+d*.1}return s}function ut(t,n){const a=Math.min(t.length,n.length);let e=0;for(let s=0;s<a;s++)e+=(t[s]-n[s])**2;return e}function ht(t){const n=t.reduce((s,o)=>o<s?o:s,t[0]),e=255/(t.reduce((s,o)=>o>s?o:s,t[0])-n);return t.map(s=>(s-n)*e)}function mt(t,n){return[...t.reduce((e,s,o)=>(s!==n||(t[o-1]&&e.add(t[o-1]),t[o+1]&&e.add(t[o+1])),e),new Set([n]))]}const pt=(t,n,a)=>{const e=mt(n,a),s=Array(t).fill(0).map((i,r)=>r),o=s.filter(i=>!e.includes(i));return o.length>0?o:s.filter(i=>i!==a)};function vt(t,n,a,e,s){N(e),I(e,t,n,.2);var o=e.getImageData(0,0,e.canvas.width,e.canvas.height);const i=n.at(-1),r=a.map(c=>{e.putImageData(o,0,0),I(e,t,[i,c],.2);const u=k(e);return ut(u,s)}),d=r.reduce((c,u,h)=>u<r[c]?h:c,0);return a[d]}function q(t){const n=document.createElement("canvas");return n.width=t,n.height=t,n.getContext("2d",{willReadFrequently:!0})}function _t(t){return new Promise(n=>{const a=new Image;a.onload=()=>n(a),a.src=URL.createObjectURL(t)})}async function wt(t,n){const a=q(n),e=await _t(t),{width:s,height:o}=e,i=s-o,[r,d]=i>0?[i/2,0]:[0,-i/2],c=Math.min(s,o);return a.drawImage(e,r,d,c,c,0,0,n,n),a}var yt=J('<div class="p-8 flex flex-col gap-4"><div><input class="bg-emerald-200 border border-emerald-800 rounded p-4 inline" type="file"/></div> <div><button class="bg-emerald-200 p-2 border border-emerald-800 rounded min-w-2xs disabled:opacity-50">go</button></div> <div></div> <div class="flex items-center"><canvas></canvas> <canvas></canvas></div></div>');function Ct(t,n){et(n,!1);let a=y(),e=y(),s=y(),o=y();const i=200,r=1e3,d=128,c=20;async function u(){const f=l(o)[0],P=await wt(f,i),R=l(a).getContext("2d");N(R),R.drawImage(P.canvas,0,0);const V=ht(k(P)),$=q(i),p=l(e).getContext("2d"),g=[0],G=performance.now();for(;g.length<r;){const K=g.at(-1),Y=pt(d,g,K),j=vt(d,g,Y,$,V);g.push(j),g.length%c===0&&(await new Promise(requestAnimationFrame),O(s,l(s).textContent=`${g.length} / ${r}`),N(p),I(p,d,g,1))}const H=(performance.now()-G)/1e3;O(s,l(s).textContent=`done in ${H.toFixed(3)} seconds`),N(p),I(p,d,g,1)}X();var h=yt(),S=v(h),B=v(S);_(S);var C=w(S,2),L=v(C);_(C);var D=w(C,2);A(D,f=>b(s,f),()=>l(s));var E=w(D,2),m=v(E);M(m,"width",i),M(m,"height",i),A(m,f=>b(a,f),()=>l(a));var T=w(m,2);M(T,"width",i*3),M(T,"height",i*3),A(T,f=>b(e,f),()=>l(e)),_(E),_(h),at(()=>L.disabled=(l(o),ot(()=>{var f;return((f=l(o))==null?void 0:f.length)<1}))),gt(B,()=>l(o),f=>b(o,f)),rt("click",L,u),W(t,h),st()}export{Ct as component};
